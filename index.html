<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ğŸ›¡ DÃ©tection de Fraude Bancaire</title>

<style>
:root{
  --main-blue:#1e88e5;
  --light-card:#f8f9fa;
  --dark-bg:#121212;
  --dark-card:#1e1e1e;
  --light-text:#333;
  --dark-text:#eee;
}

body{
  font-family:'Segoe UI',sans-serif;
  margin:0; padding:40px 20px;
  display:flex; justify-content:center;
  background:linear-gradient(to right,#e3f2fd,#fff);
  color:var(--light-text);
  transition:0.4s;
}

body.dark-mode{
  background:var(--dark-bg);
  color:var(--dark-text);
}

.container{
  max-width:750px; width:100%;
  background:white;
  padding:40px;
  border-radius:16px;
  box-shadow:0 8px 30px rgba(0,0,0,0.1);
}

body.dark-mode .container{background:var(--dark-card);}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:25px;
}

.header span{font-weight:bold;}

.actions{display:flex; gap:10px; flex-wrap:wrap;}

.btn{
  text-decoration:none;
  padding:8px 12px;
  border-radius:10px;
  color:white;
  font-weight:600;
  font-size:0.9rem;
  background:linear-gradient(to right,#42a5f5,#1e88e5);
}

.btn.logout{background:#e53935;}
.btn.logout:hover{background:#b71c1c;}

.toggle-btn{
  position:fixed;
  top:20px; right:20px;
  background:var(--main-blue);
  color:white;
  border:none;
  padding:10px 14px;
  border-radius:8px;
  cursor:pointer;
}

h2{text-align:center;color:var(--main-blue);margin-bottom:25px;}

.card{
  background:var(--light-card);
  padding:25px 30px;
  margin-bottom:25px;
  border-radius:14px;
  border-left:5px solid var(--main-blue);
}

body.dark-mode .card{
  background:#1e1e1e;
  border-left-color:#90caf9;
}

label{font-weight:600; display:block; margin-bottom:6px;}

input,select{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-bottom:15px;
  box-sizing:border-box;
}

body.dark-mode input,
body.dark-mode select{
  background:#2a2a2a;
  color:var(--dark-text);
  border-color:#555;
}

.form-row{
  display:flex;
  gap:20px;
  flex-wrap:wrap;
}

.form-group{flex:1; min-width:220px;}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  background:linear-gradient(to right,#42a5f5,#1e88e5);
  color:white;
  font-size:1.1rem;
  font-weight:bold;
  cursor:pointer;
}

button:hover{
  background:linear-gradient(to right,#1e88e5,#1565c0);
}

.result{
  margin-top:30px;
  text-align:center;
  font-weight:bold;
  font-size:1.2rem;
}
.result-normal{color:green;}
.result-fraud{color:red;}

/* Style pour les messages flash */
.flash-messages{
  margin-bottom:20px;
}
.alert{
  padding:12px;
  border-radius:8px;
  margin-bottom:10px;
}
.alert-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;}
.alert-danger{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
.alert-info{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb;}
.alert-warning{background:#fff3cd;color:#856404;border:1px solid #ffeaa7;}
</style>

<script>
function toggleMode(){
  document.body.classList.toggle("dark-mode");
}
</script>
</head>

<body>

<button class="toggle-btn" onclick="toggleMode()">ğŸŒ“ Mode sombre</button>

<div class="container">

<div class="header">
  <span>ğŸ‘‹ Bonjour, {{ username }}</span>
  <div class="actions">
    <a href="{{ url_for('dashboard') }}" class="btn">ğŸ“Š Dashboard</a>
    <a href="{{ url_for('analysis') }}" class="btn">â­ Analyse Globale</a>
    <a href="{{ url_for('user_analysis') }}" class="btn">ğŸ“ˆ Analyse PrÃ©dictions</a>
    <a href="{{ url_for('logout') }}" class="btn logout">ğŸšª DÃ©connexion</a>
  </div>
</div>

<!-- Messages flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<h2>ğŸ›¡ DÃ©tection de Fraude Bancaire</h2>

<div style="text-align:center; margin-bottom:20px;">
  <img src="{{ url_for('static', filename='photo.jpg') }}"
       style="max-width:500px; width:100%; border-radius:10px;"
       alt="Fraud Detection">
</div>

<form method="POST" action="{{ url_for('predict') }}">

<div class="card">
<h3>ğŸ§¾ Informations Transaction</h3>

<label>ğŸ“‚ CatÃ©gorie</label>
<select name="category" required>
  <option value="" disabled selected>Choisir une catÃ©gorie</option>
  {% for c in ['gas_transport','grocery_pos','grocery_net','shopping_pos','shopping_net',
               'food_dining','entertainment','travel','kids_pets','personal_care',
               'health_fitness','home','misc_pos','misc_net'] %}
    <option value="{{ c }}">{{ c }}</option>
  {% endfor %}
</select>

<label>ğŸ’° Montant (â‚¬)</label>
<input type="number" step="0.01" name="amt" placeholder="Ex: 125.50" required>

<label>ğŸ‘¤ Sexe</label>
<select name="gender" required>
  <option value="" disabled selected>Choisir le sexe</option>
  <option value="M">Homme</option>
  <option value="F">Femme</option>
</select>

<label>ğŸ™ Ville</label>
<select name="city" required>
  <option value="" disabled selected>Choisir une ville</option>
  {% if cities %}
    {% for c in cities %}
      <option value="{{ c }}">{{ c }}</option>
    {% endfor %}
  {% else %}
    <option value="">Aucune ville disponible</option>
  {% endif %}
</select>

<label>ğŸ—º Ã‰tat</label>
<select name="state" required>
  <option value="" disabled selected>Choisir un Ã©tat</option>
  {% if states %}
    {% for s in states %}
      <option value="{{ s }}">{{ s }}</option>
    {% endfor %}
  {% else %}
    <option value="">Aucun Ã©tat disponible</option>
  {% endif %}
</select>

<label>ğŸ‘¨â€ğŸ’» MÃ©tier</label>
<select name="job" required>
  <option value="" disabled selected>Choisir un mÃ©tier</option>
  {% if jobs %}
    {% for j in jobs %}
      <option value="{{ j }}">{{ j }}</option>
    {% endfor %}
  {% else %}
    <option value="">Aucun mÃ©tier disponible</option>
  {% endif %}
</select>

<label>ğŸ‘¥ Population ville</label>
<input type="number" name="city_pop" placeholder="Ex: 50000" required>

<div class="form-row">
  <div class="form-group">
    <label>ğŸ§­ Latitude marchand</label>
    <input type="number" step="0.000001" name="merch_lat" placeholder="Ex: 48.8566" required>
  </div>
  <div class="form-group">
    <label>ğŸ§­ Longitude marchand</label>
    <input type="number" step="0.000001" name="merch_long" placeholder="Ex: 2.3522" required>
  </div>
</div>
</div>

<div class="card">
<button type="submit">ğŸ” PrÃ©dire la transaction</button>
</div>

</form>

{% if prediction %}
<div class="result {% if 'frauduleuse' in prediction %}result-fraud{% else %}result-normal{% endif %}">
  {{ prediction }}
</div>
{% endif %}

</div>
</body>
</html>