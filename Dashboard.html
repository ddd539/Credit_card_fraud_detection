<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>üìä Mon Dashboard Personnel - D√©tection de Fraude</title>

<style>
:root{
  --main-blue:#1e88e5;
  --light-card:#f8f9fa;
  --dark-bg:#121212;
  --dark-card:#1e1e1e;
  --light-text:#333;
  --dark-text:#eee;
  --success:#4caf50;
  --danger:#f44336;
}

body{
  font-family:'Segoe UI',sans-serif;
  margin:0; 
  padding:20px;
  background:linear-gradient(to right,#e3f2fd,#fff);
  color:var(--light-text);
  transition:0.4s;
}

body.dark-mode{
  background:var(--dark-bg);
  color:var(--dark-text);
}

.container{
  max-width:1400px; 
  margin:0 auto;
  background:white;
  padding:30px;
  border-radius:16px;
  box-shadow:0 8px 30px rgba(0,0,0,0.1);
}

body.dark-mode .container{background:var(--dark-card);}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:30px;
  padding-bottom:20px;
  border-bottom:2px solid #e0e0e0;
}

body.dark-mode .header{border-bottom-color:#333;}

.header h1{
  margin:0;
  color:var(--main-blue);
  font-size:2rem;
}

.user-info{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color:white;
  padding:10px 20px;
  border-radius:10px;
  font-weight:600;
  margin-top:10px;
}

.actions{display:flex; gap:10px; flex-wrap:wrap;}

.btn{
  text-decoration:none;
  padding:8px 12px;
  border-radius:10px;
  color:white;
  font-weight:600;
  font-size:0.9rem;
  background:linear-gradient(to right,#42a5f5,#1e88e5);
  transition:0.3s;
}

.btn:hover{
  background:linear-gradient(to right,#1e88e5,#1565c0);
  transform:translateY(-2px);
}

.toggle-btn{
  position:fixed;
  top:20px; right:20px;
  background:var(--main-blue);
  color:white;
  border:none;
  padding:10px 14px;
  border-radius:8px;
  cursor:pointer;
  z-index:1000;
}

/* Stats Cards */
.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
  gap:20px;
  margin-bottom:30px;
}

.stat-card{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding:20px;
  border-radius:12px;
  color:white;
  text-align:center;
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
  transition:0.3s;
}

.stat-card:hover{
  transform:translateY(-5px);
  box-shadow:0 8px 25px rgba(0,0,0,0.15);
}

.stat-card.success{
  background:linear-gradient(135deg, #4caf50 0%, #45a049 100%);
}

.stat-card.danger{
  background:linear-gradient(135deg, #f44336 0%, #e53935 100%);
}

.stat-card.info{
  background:linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
}

.stat-card.warning{
  background:linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
}

.stat-card h3{
  font-size:0.9rem;
  margin:0 0 10px 0;
  opacity:0.9;
  text-transform:uppercase;
  letter-spacing:1px;
}

.stat-card .value{
  font-size:2.5rem;
  font-weight:bold;
  margin:0;
}

.stat-card .label{
  font-size:0.85rem;
  margin-top:5px;
  opacity:0.8;
}

/* Graph Cards */
.graphs-grid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:25px;
  margin-top:30px;
}

.graph-card{
  background:var(--light-card);
  padding:25px;
  border-radius:14px;
  box-shadow:0 4px 15px rgba(0,0,0,0.08);
  border-left:5px solid var(--main-blue);
}

.graph-card.full-width{
  grid-column: 1 / -1;
}

body.dark-mode .graph-card{
  background:#1e1e1e;
  border-left-color:#90caf9;
}

.graph-card h2{
  margin-top:0;
  color:var(--main-blue);
  font-size:1.3rem;
}

/* Flash messages */
.flash-messages{
  margin-bottom:20px;
}

.alert{
  padding:15px;
  border-radius:8px;
  margin-bottom:10px;
  font-weight:500;
}

.alert-info{
  background:#d1ecf1;
  color:#0c5460;
  border:1px solid #bee5eb;
}

/* Responsive */
@media (max-width: 768px){
  .stats-grid{
    grid-template-columns:1fr;
  }
  .graphs-grid{
    grid-template-columns:1fr !important;
  }
  .graph-card.full-width{
    grid-column: 1;
  }
  .header h1{
    font-size:1.5rem;
  }
}
</style>

<script>
function toggleMode(){
  document.body.classList.toggle("dark-mode");
}
</script>
</head>

<body>

<button class="toggle-btn" onclick="toggleMode()">üåì Mode</button>

<div class="container">

<!-- Header -->
<div class="header">
  <div>
    <h1>üìä Mon Dashboard Personnel</h1>
    <div class="user-info">üë§ Connect√© en tant que: {{ current_user.username }}</div>
  </div>
  <div class="actions">
    <a href="{{ url_for('home') }}" class="btn">üè† Accueil</a>
    <a href="{{ url_for('analysis') }}" class="btn">‚≠ê Analyse CSV</a>
    <a href="{{ url_for('user_analysis') }}" class="btn">üìà Mes Pr√©dictions</a>
  </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Stats Cards -->
<div class="stats-grid">
  <div class="stat-card info">
    <h3>üìù Mes Transactions</h3>
    <div class="value">{{ total_transactions }}</div>
    <div class="label">Total de mes analyses</div>
  </div>
  
  <div class="stat-card success">
    <h3>‚úÖ Transactions Normales</h3>
    <div class="value">{{ total_normal }}</div>
    <div class="label">{{ "%.1f"|format((total_normal/total_transactions*100) if total_transactions > 0 else 0) }}% de mes transactions</div>
  </div>
  
  <div class="stat-card danger">
    <h3>‚ùå Fraudes D√©tect√©es</h3>
    <div class="value">{{ total_frauds }}</div>
    <div class="label">{{ "%.1f"|format(fraud_percentage) }}% de mes transactions</div>
  </div>
  
  <div class="stat-card warning">
    <h3>üìä Taux de Fraude</h3>
    <div class="value">{{ "%.1f"|format(fraud_percentage) }}%</div>
    <div class="label">Pourcentage global</div>
  </div>
</div>

<!-- Graphs -->
<div class="graphs-grid">
  
  <!-- Premi√®re ligne: Pie chart et Genre -->
  {% if pie_html %}
  <div class="graph-card">
    {{ pie_html|safe }}
  </div>
  {% endif %}
  
  {% if gender_html %}
  <div class="graph-card">
    {{ gender_html|safe }}
  </div>
  {% endif %}
  
  <!-- Deuxi√®me ligne: Evolution temporelle (pleine largeur) -->
  {% if time_html %}
  <div class="graph-card full-width">
    {{ time_html|safe }}
  </div>
  {% endif %}
  
</div>

</div>
</body>
</html>